#!/usr/bin/env bash

if ! [ -t 0 ]; then
    read -d '' pipe
fi

echo "Compiling source.."

# check target folder
if [ ! -d out ]; then
  mkdir out
fi

# compile and run tests
if [ "$1" = "test" ]; then

    javac */*/*/*/*/*.java -sourcepath src:test -cp out:third/junit.jar -d out -source 8 -target 8

    echo "Running tests.."

    java -ea -cp out:third/junit.jar:third/hamcrest.jar org.junit.runner.JUnitCore net.researchgate.challenge.impl.RandomSamplerTest net.researchgate.challenge.impl.BaseStreamerTest net.researchgate.challenge.impl.HttpStreamerTest net.researchgate.challenge.impl.RandomStreamerTest

# compile and run actual
else

    javac */*.java -sourcepath src -d out -source 8 -target 8

    echo "Running the sampler.."

    if [[ -n $pipe ]]; then
        java -ea -cp out Main $1 $2 $3 "$pipe"
    else
        java -ea -cp out Main $1 $2 $3
    fi



fi